@{
    ViewData["Title"] = "Water Usage Map";
    Layout = "~/Views/Shared/_HomeLayout.cshtml";
}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-geo@4.2.1/build/index.umd.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
    .diag-background {
        background-image: url('../images/leaf_4.png');
        min-height: 100vh;
        padding: 50px 20px;
        display: flex;
        justify-content: center;
        align-items: flex-start;
    }

    .diag-content {
        background-color: #c7dbbf;
        padding: 40px;
        border-radius: 20px;
        max-width: 1200px;
        width: 100%;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 17px;
        opacity: .95;
    }

    .section-title {
        font-size: 22px;
        font-weight: bold;
        color: #00796b;
        margin-bottom: 20px;
    }
</style>

<div class="diag-background">
    <div class="diag-content">
        <div class="section-title">Water Withdrawal by Region (2023)</div>
        <div id="waterMapChart" style="width: 100%; height: 600px;"></div>
    </div>
</div>

<script>
    const waterData = @Html.Raw(ViewBag.WaterMapDataJson ?? "[]");

    const geojson = {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "properties": { "name": "North America" },
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [[[-168.0, 83.0], [-52.0, 83.0], [-52.0, 7.0], [-168.0, 7.0], [-168.0, 83.0]]]
                }
            },
            {
                "type": "Feature",
                "properties": { "name": "Latin America" },
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [[[-117.0, 32.0], [-34.0, 32.0], [-34.0, -55.0], [-117.0, -55.0], [-117.0, 32.0]]]
                }
            },
            {
                "type": "Feature",
                "properties": { "name": "Europe, Middle East, Africa" },
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [[[-25.0, 71.0], [60.0, 71.0], [60.0, -35.0], [-25.0, -35.0], [-25.0, 71.0]]]
                }
            },
            {
                "type": "Feature",
                "properties": { "name": "Asia" },
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [[[60.0, 80.0], [180.0, 80.0], [180.0, 0.0], [60.0, 0.0], [60.0, 80.0]]]
                }
            }
        ]
    };

    const data = [{
        type: 'choropleth',
        geojson: geojson,
        locations: waterData.map(d => d.Region),
        z: waterData.map(d => d.Amount),
        text: waterData.map(d => d.Region),
        colorscale: 'Blues',
        autocolorscale: false,
        marker: {
            line: {
                color: 'gray',
                width: 0.5
            }
        },
        colorbar: {
            title: 'Water Withdrawal (ML)'
        }
    }];

    const layout = {
        title: 'Water Withdrawal by Region (2023)',
        geo: {
            projection: {
                type: 'equirectangular'
            }
        }
    };

    Plotly.newPlot('waterMapChart', data, layout);
</script>
